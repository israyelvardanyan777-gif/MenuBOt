<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App Dash Վճարում</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 20px; }
        .section-title { font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; }
        .section-number { background: #007bff; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 8px; }
        .dash-wallet, #productImageContainer { margin-top: 12px; }
        .wallet-address, .payment-amount { margin-top: 8px; font-weight: bold; }
        .status-indicator { margin-top: 8px; padding: 4px 8px; border-radius: 4px; display: inline-flex; align-items: center; }
        .status-pending { background-color: #ffeeba; color: #856404; }
        .status-paid { background-color: #d4edda; color: #155724; }
        .status-failed { background-color: #f8d7da; color: #721c24; }
        .verify-btn { margin-top: 12px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background: #007bff; color: white; }
        .image-placeholder { border: 1px dashed #ccc; border-radius: 12px; padding: 40px; text-align: center; color: #999; }
        img { border-radius: 12px; max-width: 100%; }
        #notification { margin-top: 12px; font-weight: bold; color: green; }
    </style>
</head>
<body>

    <!-- Step 3: Dash Payment -->
    <div class="section">
        <div class="section-title">
            <div class="section-number">3</div>
            <i class="fab fa-bitcoin"></i>
            Dash Blockchain վճարում
        </div>
        <div class="dash-wallet">
            <div class="wallet-header">
                <div class="wallet-icon">D</div>
                <div class="wallet-title">Dash Wallet</div>
            </div>
            <div class="wallet-address" id="walletAddress">
                Xj4KqT8n9vR2mL5pW7sA3bC6dE9fG1hI2jK4lM7nO8pQ
            </div>
            <div class="payment-amount" id="paymentAmount">0.01 DASH</div>
            <div class="payment-label">Վճարման գումար</div>
            <div class="status-indicator status-pending" id="paymentStatus">
                <i class="fas fa-clock"></i>
                Սպասում է վճարման
            </div>
            <button class="verify-btn" onclick="verifyPayment()" id="verifyBtn" disabled>
                <i class="fas fa-search"></i>
                Ստուգել վճարումը
            </button>
        </div>
    </div>

    <!-- Step 4: Product Image Display -->
    <div class="section">
        <div class="section-title">
            <div class="section-number">4</div>
            <i class="fas fa-image"></i>
            Ապրանքի նկար
        </div>
        <div id="productImageContainer">
            <div class="image-placeholder">
                <div class="placeholder-text">
                    <i class="fas fa-image" style="font-size: 32px; margin-bottom: 12px; display: block;"></i>
                    Ընտրեք շրջան և ապրանք<br>
                    նկարի ավտոմատ ցուցադրման համար
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let selectedDistrict = 'Կենտրոն';
        let selectedWeight = '0.5G';
        let selectedPrice = 0.01; // DASH
        let paymentVerified = false;

        const DASH_ADDRESS = "Xj4KqT8n9vR2mL5pW7sA3bC6dE9fG1hI2jK4lM7nO8pQ";
        const paymentStatus = document.getElementById("paymentStatus");
        const verifyBtn = document.getElementById("verifyBtn");

        // Նկարների տվյալներ ըստ շրջանների և քաշի
        const productImages = {
            "Կենտրոն": {
                "0.5G": "images/kentron_0_5g.jpg",
                "1.0G": "images/kentron_1g.jpg"
            },
            "Մասիվ": {
                "0.5G": "images/masiv_0_5g.jpg",
                "1.0G": "images/masiv_1g.jpg"
            }
        };

        function displayProductImage() {
            const container = document.getElementById("productImageContainer");
            container.innerHTML = '';

            if (!selectedDistrict || !selectedWeight) {
                container.innerHTML = `
                    <div class="image-placeholder">
                        <div class="placeholder-text">
                            <i class="fas fa-image" style="font-size: 32px; margin-bottom: 12px; display: block;"></i>
                            Ընտրեք շրջան և ապրանք<br>
                            նկարի ավտոմատ ցուցադրման համար
                        </div>
                    </div>
                `;
                return;
            }

            const imageUrl = productImages[selectedDistrict]?.[selectedWeight];
            if (imageUrl) {
                const img = document.createElement("img");
                img.src = imageUrl;
                img.alt = `${selectedDistrict} - ${selectedWeight}`;
                container.appendChild(img);
            } else {
                container.innerHTML = "<p>Նկար չի գտնվել համար ընտրված ապրանքի</p>";
            }
        }

        async function verifyPayment() {
            paymentStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ստուգվում է…';
            try {
                const response = await fetch(`https://chainz.cryptoid.info/dash/api.dws?q=address&a=${DASH_ADDRESS}`);
                if (!response.ok) throw new Error("API-ին հասանելի չէ");
                const txs = await response.text();
                if (txs.includes(selectedPrice.toString())) {
                    paymentVerified = true;
                    paymentStatus.className = 'status-indicator status-paid';
                    paymentStatus.innerHTML = '<i class="fas fa-check"></i> Վճարվել է';
                    displayProductImage();
                    document.getElementById("notification").innerText = "Վճարումը հաստատված է, ահա ձեր ապրանքը:";
                } else {
                    paymentStatus.className = 'status-indicator status-failed';
                    paymentStatus.innerHTML = '<i class="fas fa-times"></i> Չի վճարվել';
                }
            } catch (err) {
                paymentStatus.className = 'status-indicator status-failed';
                paymentStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Սխալ՝ ${err.message}`;
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            verifyBtn.disabled = false;
        });
    </script>

</body>
</html>
